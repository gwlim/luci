XHR=function(){this.reinit=function(){window.XMLHttpRequest?this._xmlHttp=new XMLHttpRequest:window.ActiveXObject?this._xmlHttp=new ActiveXObject("Microsoft.XMLHTTP"):alert("xhr.js: XMLHttpRequest is not supported by this browser!")};this.busy=function(){if(!this._xmlHttp)return!1;switch(this._xmlHttp.readyState){case 1:case 2:case 3:return!0;default:return!1}};this.abort=function(){this.busy()&&this._xmlHttp.abort()};this.get=function(a,c,d){this.reinit();var b=this._xmlHttp;c=this._encode(c);a=
location.protocol+"//"+location.host+a;c&&(a="&"==a.substr(a.length-1,1)?a+c:a+("?"+c));b.open("GET",a,!0);b.onreadystatechange=function(){if(4==b.readyState){var a=null;if("application/json"==b.getResponseHeader("Content-Type"))try{a=eval("("+b.responseText+")")}catch(c){a=null}d(b,a)}};b.send(null)};this.post=function(a,c,d){this.reinit();var b=this._xmlHttp;c=this._encode(c);b.onreadystatechange=function(){4==b.readyState&&d(b)};b.open("POST",a,!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");
b.setRequestHeader("Content-length",c.length);b.setRequestHeader("Connection","close");b.send(c)};this.cancel=function(){this._xmlHttp.onreadystatechange=function(){};this._xmlHttp.abort()};this.send_form=function(a,c,d){for(var b="",g=0;g<a.elements.length;g++){var e=a.elements[g];if(e.options)b+=(b?"&":"")+a.elements[g].name+"="+encodeURIComponent(e.options[e.selectedIndex].value);else if(e.length)for(var f=0;f<e.length;f++)e[f].name&&(b+=(b?"&":"")+e[f].name+"="+encodeURIComponent(e[f].value));
else b+=(b?"&":"")+e.name+"="+encodeURIComponent(e.value)}if("object"==typeof d)for(var h in d)b+=(b?"&":"")+h+"="+encodeURIComponent(d[h]);return"get"==a.method?this.get(a.getAttribute("action"),b,c):this.post(a.getAttribute("action"),b,c)};this._encode=function(a){a=a?a:{};a._=Math.random();if("object"==typeof a){var c="",d;for(d in a)c+=(c?"&":"")+d+"="+encodeURIComponent(a[d]);return c}return a}};XHR.get=function(a,c,d){(new XHR).get(a,c,d)};
XHR.poll=function(a,c,d,b){if(isNaN(a)||1>a)a=5;XHR._q||(XHR._t=0,XHR._q=[],XHR._r=function(){for(var a=0,b=XHR._q[0];a<XHR._q.length;b=XHR._q[++a])!(XHR._t%b.interval)&&!b.xhr.busy()&&b.xhr.get(b.url,b.data,b.callback);XHR._t++});XHR._q.push({interval:a,callback:b,url:c,data:d,xhr:new XHR});XHR.run()};
XHR.halt=function(){if(XHR._i){try{document.getElementById("xhr_poll_status").style.display="",document.getElementById("xhr_poll_status_on").style.display="none",document.getElementById("xhr_poll_status_off").style.display=""}catch(a){}window.clearInterval(XHR._i);XHR._i=null}};
XHR.run=function(){if(XHR._r&&!XHR._i){try{document.getElementById("xhr_poll_status").style.display="",document.getElementById("xhr_poll_status_on").style.display="",document.getElementById("xhr_poll_status_off").style.display="none"}catch(a){}XHR._r();XHR._i=window.setInterval(XHR._r,1E3)}};XHR.running=function(){return!(!XHR._r||!XHR._i)};
